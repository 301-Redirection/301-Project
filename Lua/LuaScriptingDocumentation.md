# Lua Scripting Documentation

## 1. Introduction

The purpose of this document is to provide insight into the functions and code utilised in the lua scripts generated by the DotA 2 bot configuration system.

## 2. Terminology and Concepts

Dota/Dota 2 - Defense of the Ancients 2, the game for which we are designing the bot configuration system.

Ancient - The core building of each team, and must be protected at all costs. Losing this building loses the game.

Bot - a computer controlled hero in a team in Dota.

Radiant - The team on the left hand-side of the Dota map.

Dire - The team on the right-hand side of the Dota map.

HP - Hit Points, the amount of sustained damage a hero can take.

MP - Mana Points, used for casting spells.

Lane - One of three paths on the Dota map. The lanes are located on the Left/Top side of the map, Middle and Bottom/Right side of the map and are referred to as top, mid and bottom/bot lanes, respectively. Lanes can also be classified into 3 types: Safe Lane, Mid Lane and Offlane. The Safe Lane has its Tower placed furthest from base to provide additional support for the heroes in that lane. For Radiant, Safe Lane is the bot lane. For Dire, it is top lane. Both Radiant and Dire have their Mid lane in the mid lane, and the towers are placed mostly equally apart on each side of the map, providing a very equal match-up between the heroes in the lane. Offlane is the hardest lane, because the tower is closest to the base and the activity in the lane is likely futher away from this tower in this lane than the other team. For Radiant, Offlane is top lane and for Dire it is bottom lane. Note that a safe lane faces the offlane of the opposing team.

River - the river that divides the map into the Radiant and Dire sides.

Jungle - The areas on the map that is not a lane or in the river.

Objective - An entity in the Dota game that is one of many steps in achieving victory. An objective can be a Tower, a Barracks or Roshan.

Roshan - A massive ancient creep that grants bonuses to the heroes that kill him, including Aegis of Immortals, Cheese and a Refresher Shard. The Aegis will grant any hero who wields it a second life; the cheese will instantly restore 2000 HP and MP, and the Refresher Shard is a one-time use item that instantly refreshes all cooldowns of a hero.

Tower - A defensive Turrent that can be destroyed by the opposing team. There are 3 turrets per lane, each placed more or less the same distance apart in the lane, but distances do vary. These towers are referred to as Tier x towers, where x is either 1, 2 or 3 with a Tier 1 tower being furthest from base and Tier 3 being closest to base. There are an additional 2 towers in front of the team's Ancient, called Tier 4 towers.

Teamfight - A big fight involving nearly all team members of both teams in any arbitrary location on the map. The victor of the teamfight is determined by the number of losses, and if it is even, it is then decided by the number of core heroes still alive, and if it is still even, then it is either decided by the net gold change of a team, or it is dubbed a draw. Victory in a teamfight will likely result in an objective being taken, whereas defeat will result in a very defense stance taken by the team.

Creeps - Little minions that spawn and run down a lane to meet the opposing lane's creeps, also called a creep wave. There are also neutral creeps that spawn in the jungle areas of the map that give gold and experience when killed. If a team destroys a barracks of the enemy team, then the creeps of the team that destroyed the barracks will start spawning stronger, upgraded creeps in that lane, called super creeps. Once all barracks are destroyed, the creeps are further upgraded to mega creeps. An upgraded creep has more HP, and gives less gold and experience.

Push - a collective effort from a team to attempt to advance down a lane to attempt to take an objective, a teamfight, or both.

Farm - The simple activity of a hero collecting gold and experience by killing creeps. 

Defend - The act of staying close to or even behind your own tower and creep wave when the enemy team is pushing down your lane.

Roaming - the act of not remaining in a lane for too long, but rather move between lanes to attempt to kill enemy heroes with the other heroes in that lane/ or in the jungle. 

Ganking - The act of a group of team players grouping together to attempt to kill enemy heroes on the map.

## 3. Documentation of scripts and their functions

The following points are subdivided by file and then further by the important functions that are being implemented to be used by the bot team.

### 3.1 Configuration Format

The ConfigurationFormat.ts contains the ConfigurationFormat class. The file looks as follows:

```typescript
export class ConfigurationFormat {
    name: string;
    description: string;
    
    push: {
        top: Condition[];
        mid: Condition[];
        bot: Condition[];
    };
    farm: {
        top: Condition[];
        mid: Condition[];
        bot: Condition[];
    };
    defend: {
        top: Condition[];
        mid: Condition[];
        bot: Condition[];
    };
    roam: Condition[];
    roshan: Condition[];
}

export class Condition {
    trigger: Trigger;
    operator: Operator;
    conditional: any;
    action: any;
}

enum Trigger {
    Time = 1,
    EnemyHeroesAlive,
    AlliedHeroesAlive
}

enum Operator {
    LessThan = 1,
    LessThanEqualTo,
    EqualTo,
    GreaterThanEqualTo,
    GreaterThan,
    NotEqual
}
```

Each of push, farm, defend, roam and roshan correspond to a function in team_desires.lua, which are explained in more detail below. Push, defend and farm are objects that have properties for each of the 3 lanes on the map. 

Each lane property is an array of Condition objects that will be converted into lua conditions. A Condition object has 3 properties: a trigger, an operator and a value. The trigger is the event in the game of Dota that is to be evaluated in the condition. It is of type Trigger which is an enumerated type and has predefined options to choose from, as shown in the code. The operator is an enumerated value that corresponds to one of the values in the enum Operator and determines the type of relation it is that the condition should test. Finally, the value is the value to be tested against the trigger. This is of type `any` as it is possible to test it against numbers, literal strings or even lua functions. 

### 3.2 Team Desires (team_desires.lua)

This file contains functions that determine the desires of the team as a whole.

#### 3.2.1 UpdatePushLaneDesires()

This functions returns a vector of 3 floating point values between 0 and 1 that represents the collective desire of the bot team to push each of the 3 lanes on the map. A value of 1 is an absolute desire and 0 is no desire at all. The first value corresponds to the top lane, the second for mid lane and the last for bottom lane.

There are several factors that influence the desire of a team to push a specfic lane:

* Whether the enemy team is alive or not, or rather, how many of the heroes on the enemy team is alive. Fewer heroes alive means a greater desire to push a lane.
* Whether the entire allied team is alive or not. There will be little to no desire to push if the team is mostly dead.
* Where the creep waves have met in the lane. A creep wave closer to the team's base/tower will result in a higher desire to push the lane to the opposite side of the map.
* Whether the team has any illusions/controllable minions with them, or can spawn any. If the team does, they will have a greater desire to push.
* Whether the enemy team is close by or not. If they are close by, there will be little desire to push the lane.

#### 3.2.2 UpdateDefendLaneDesires()

This function also returns a vector of 3 floating point values between 0 and 1 representing the team's desire to push top, mid and bottom lanes respectively. A value of 1 is an absolute desire and 0 is no desire at all. 

Factors influencing defense of a lane:

* If the enemy team is pushing down a lane, the team will have a higher desire to defend that lane.
* If enemy creeps are mega creeps, then the team will have a much stronger desire to defend
* If any creeps are attacking buildings, the team will have a strong desire to defend.

#### 3.2.3 UpdateFarmLaneDesires()

This function also returns a vector of 3 floating point values between 0 and 1 representing the team's desire to push top, mid and bottom lanes respectively. A value of 1 is an absolute desire and 0 is no desire at all.

Factors influencing the desire to farm the lane:

* It is early in the game and the heroes cannot sustain a full push
* The heroes are spread out accross the map and cannot group together for a push
* The heroes desire to Push/Defend is very low

#### 3.2.4 UpdateRoamDesire()

This function returns a floating point value between 0 and 1, as well as a unit handle of a hero on the enemy team. The number represents the team's desire to go gank the specified target on the enemy team.

Factors influencing the desire for a team to go gank:

* An enemy hero is alone in a lane
* It is early in the game. (Note: Ganking is important throughout the game, but it is more so in the early game since a team wishes to **get** an advantage as soon as possible, later in the game you wish to **maintain** the advantage, if you have it. Recovering from a deficit is explained next)
* If the team feels they are behind, in terms of kills or farm, the team will have a strong desire to go gank a target.

Generally, the team will attempt to gank a/the enemy core, but any hero is still better than none. Priority therfore falls first to cores and then on to supports.

#### 3.2.5 UpdateRoshanDesire()

This function simply returns a single floating point value between 0 and 1, and it represents the team's desire to go and attempt to defeat Roshan. 

Factors influencing a team to go and attempt a Roshan kill:

* The enemy team has dead heroes. More dead heroes will result in a higher desire to go attempt to kill Roshan.
* The team wishes to push the Tier 3 tower in any given lane. This should result in a higher desire to kill Roshan.